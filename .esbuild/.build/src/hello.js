"use strict";var u=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var O=Object.prototype.hasOwnProperty;var g=(t,e)=>{for(var o in e)u(t,o,{get:e[o],enumerable:!0})},T=(t,e,o,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of S(e))!O.call(t,n)&&n!==o&&u(t,n,{get:()=>e[n],enumerable:!(s=R(e,n))||s.enumerable});return t};var N=t=>T(u({},"__esModule",{value:!0}),t);var V={};g(V,{handler:()=>k});module.exports=N(V);var C=require("events"),w=()=>{},H={timeoutEarlyInMillis:5,timeoutEarlyResponse:()=>{throw new Error("Timeout")}},I=(t=w,e={})=>{var a;typeof t!="function"&&(e=t,t=w),e={...H,...e},e.timeoutEarly=e.timeoutEarlyInMillis>0,(a=e.beforePrefetch)==null||a.call(e);let o=[],s=[],n=[],r=(i={},d={})=>{var c;(c=e.requestStart)==null||c.call(e);let f={event:i,context:d,response:void 0,error:void 0,internal:e.internal??{}};return L(f,[...o],t,[...s],[...n],e)};return r.use=i=>{Array.isArray(i)||(i=[i]);for(let d of i){let{before:f,after:c,onError:l}=d;if(!f&&!c&&!l)throw new Error('Middleware must be an object containing at least one key among "before", "after", "onError"');f&&r.before(f),c&&r.after(c),l&&r.onError(l)}return r},r.before=i=>(o.push(i),r),r.after=i=>(s.unshift(i),r),r.onError=i=>(n.unshift(i),r),r.handler=i=>(t=i,r),r},L=async(t,e,o,s,n,r)=>{var i,d,f;let a=r.timeoutEarly&&t.context.getRemainingTimeInMillis;try{if(await h(t,e,r),typeof t.response>"u"){(i=r.beforeHandler)==null||i.call(r);let c=new AbortController,l;a&&(l=new AbortController),t.response=await Promise.race([o(t.event,t.context,{signal:c.signal}),a?B(t.context.getRemainingTimeInMillis()-r.timeoutEarlyInMillis,{signal:l.signal}).then(()=>(c.abort(),r.timeoutEarlyResponse())):Promise.race([])]),a&&l.abort(),(d=r.afterHandler)==null||d.call(r),await h(t,s,r)}}catch(c){t.response=void 0,t.error=c;try{await h(t,n,r)}catch(l){throw l.originalError=t.error,t.error=l,t.error}if(typeof t.response>"u")throw t.error}finally{await((f=r.requestEnd)==null?void 0:f.call(r,t))}return t.response},h=async(t,e,o)=>{var s,n;for(let r of e){(s=o.beforeMiddleware)==null||s.call(o,r.name);let a=await r(t);if((n=o.afterMiddleware)==null||n.call(o,r.name),typeof a<"u"){t.response=a;return}}},j=()=>{if(process.version<"v15.0.0"){class t{toString(){return"[object AbortSignal]"}get[Symbol.toStringTag](){return"AbortSignal"}removeEventListener(o,s){this.eventEmitter.removeListener(o,s)}addEventListener(o,s){this.eventEmitter.on(o,s)}dispatchEvent(o){let s={type:o,target:this},n=`on${o}`;typeof this[n]=="function"&&this[n](s),this.eventEmitter.emit(o,s)}constructor(){this.eventEmitter=new C.EventEmitter,this.onabort=null,this.aborted=!1}}return class{abort(){this.signal.aborted||(this.signal.aborted=!0,this.signal.dispatchEvent("abort"))}toString(){return"[object AbortController]"}get[Symbol.toStringTag](){return"AbortController"}constructor(){this.signal=new t}}}else return AbortController};global.AbortController=j();var U=()=>(t,{signal:e})=>e.aborted?Promise.reject(new Error("Aborted","AbortError")):new Promise((o,s)=>{let n=()=>{clearTimeout(r),s(new Error("Aborted","AbortError"))},r=setTimeout(()=>{o(),e.removeEventListener("abort",n)},t);e.addEventListener("abort",n)}),B=U(),A=I;var E=require("https"),p,Q={httpOptions:{agent:new E.Agent({keepAlive:!0,secureProtocol:"TLSv1_2_method"})}};var v=t=>{let{response:e}=t;return typeof e>"u"?e={}:typeof(e==null?void 0:e.statusCode)>"u"&&typeof(e==null?void 0:e.body)>"u"&&typeof(e==null?void 0:e.headers)>"u"&&(e={body:e}),(p=e).headers??(p.headers={}),t.response=e,e},F=/[^a-zA-Z]/g,y=class extends Error{constructor(e,o,s={}){o&&typeof o!="string"&&(s=o,o=void 0),o??(o=b[e]),super(o),this.cause=s.cause;let n=b[e].replace(F,"");this.name=n.substr(-5)!=="Error"?n+"Error":n,this.status=this.statusCode=e,this.expose=s.expose??e<500}},x=(t,e,o={})=>new y(t,e,o),b={100:"Continue",101:"Switching Protocols",102:"Processing",103:"Early Hints",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"(Unused)",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"};var z=/^application\/(.+\+)?json(;.*)?$/,J={reviver:void 0},G=(t={})=>{let{reviver:e}={...J,...t};return{before:async s=>{let{headers:n,body:r}=s.event,a=n["Content-Type"]??n["content-type"];if(!!z.test(a))try{let i=s.event.isBase64Encoded?Buffer.from(r,"base64").toString():r;s.event.rawBody=r,s.event.body=JSON.parse(i,e)}catch(i){let d=x(422,"Invalid or malformed JSON was provided");throw d.cause=i,d}}}},P=G;var K=(t,e={})=>e.origins.length>0?t&&e.origins.includes(t)?t:e.origins[0]:t&&e.credentials&&e.origin==="*"?t:e.origin,D={getOrigin:K,credentials:void 0,headers:void 0,methods:void 0,origin:"*",origins:[],exposeHeaders:void 0,maxAge:void 0,requestHeaders:void 0,requestMethods:void 0,cacheControl:void 0,vary:void 0},_=(t={})=>{let e={...D,...t},o=async n=>{var f;v(n);let{headers:r}=n.response,a=Object.keys(r);if(a.includes("Access-Control-Allow-Credentials")&&(e.credentials=r["Access-Control-Allow-Credentials"]==="true"),e.credentials&&(r["Access-Control-Allow-Credentials"]=String(e.credentials)),e.headers&&!a.includes("Access-Control-Allow-Headers")&&(r["Access-Control-Allow-Headers"]=e.headers),e.methods&&!a.includes("Access-Control-Allow-Methods")&&(r["Access-Control-Allow-Methods"]=e.methods),!a.includes("Access-Control-Allow-Origin")){let c=n.event.headers??{},l=c.Origin??c.origin;r["Access-Control-Allow-Origin"]=e.getOrigin(l,e)}let i=e.vary;r["Access-Control-Allow-Origin"]!=="*"&&!i&&(i="Origin"),i&&!a.includes("Vary")&&(r.Vary=i),e.exposeHeaders&&!a.includes("Access-Control-Expose-Headers")&&(r["Access-Control-Expose-Headers"]=e.exposeHeaders),e.maxAge&&!a.includes("Access-Control-Max-Age")&&(r["Access-Control-Max-Age"]=String(e.maxAge)),e.requestHeaders&&!a.includes("Access-Control-Request-Headers")&&(r["Access-Control-Request-Headers"]=e.requestHeaders),e.requestMethods&&!a.includes("Access-Control-Request-Methods")&&(r["Access-Control-Request-Methods"]=e.requestMethods);let d=(f=m[n.event.version??"1.0"])==null?void 0:f.call(m,n.event);if(!d)throw new Error("[http-cors] Unknown http event format");d==="OPTIONS"&&e.cacheControl&&!a.includes("Cache-Control")&&(r["Cache-Control"]=e.cacheControl),n.response.headers=r};return{after:o,onError:async n=>{if(n.response!==void 0)return o(n)}}},m={"1.0":t=>t.httpMethod,"2.0":t=>t.requestContext.http.method},M=_;var k=A(async t=>({statusCode:200,body:JSON.stringify({data:"hello world!"})})).use(P()).use(M());0&&(module.exports={handler});
